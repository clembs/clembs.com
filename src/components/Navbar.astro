---
import Clembs from "@assets/icons/clembs.svg";
import Globe from "@assets/icons/globe.svg";
import {
  getLangFromUrl,
  useTranslations,
  useTranslatedPaths,
} from "@i18n/utils";

const lang = getLangFromUrl(Astro.url);
const translatePaths = useTranslatedPaths(lang);
const t = useTranslations(lang);

const targets = [
  {
    name: t("about"),
    href: translatePaths("/about"),
  },
  {
    name: t("blog"),
    href: translatePaths("/blog"),
  },
];
---

<script>
  // progressive enhancements via JS: click outside && escape
  const languageInput = document.querySelector(
    "#language-input"
  ) as HTMLInputElement;

  document.addEventListener("click", (ev) => {
    if (ev.target != languageInput) {
      languageInput.checked = false;
    }
  });

  document.addEventListener("keydown", (ev) => {
    if (ev.key === "Escape") {
      languageInput.checked = false;
    }
  });
</script>

<header>
  <a
    class="logo"
    href={translatePaths("/")}
    aria-label={t("home")}
    title={t("home")}
  >
    <Clembs />
  </a>

  <div class="right">
    <nav>
      <ul>
        {
          targets.map((t) => (
            <li>
              <a class="clickable target" href={t.href}>
                {t.name}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>
    <input type="checkbox" id="language-input" />

    <label
      for="language-input"
      class="target"
      aria-label=""
      aria-controls="menu"
    >
      <Globe />

      <div id="language-menu">
        <a href={translatePaths(Astro.url.pathname, "en")}> english </a>
        <a href={translatePaths(Astro.url.pathname, "fr")}> fran√ßais </a>
      </div>
    </label>
  </div>
</header>

<style lang="scss">
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;

    background-color: var(--color-white);
    border: 1px solid var(--color-500);
    border-radius: 999px;
    margin: 1.25rem auto;
    padding: 0.5rem 1rem 0.5rem 0.5rem;
    max-width: 800px;
    width: 100%;
  }

  .logo {
    display: block;
    padding: 0.5rem;
    border-radius: 50%;
  }

  .right {
    display: flex;
    gap: 0.5rem;
  }

  nav {
    display: contents;

    ul {
      display: contents;
      list-style: none;
    }
  }

  .target {
    display: inline-grid;
    place-items: center;
    padding: 0.75rem 1.25rem;
    border-radius: 999px;
    user-select: none;
    cursor: pointer;

    @media (hover: hover) {
      &:hover {
        background-color: var(--color-40);
      }
    }

    &:is(label) {
      position: relative;
      padding: 0.5rem 0.75rem;

      :global(svg) {
        width: 1.25rem;
        height: 1.25rem;
      }
    }
  }

  input[type="checkbox"] {
    position: fixed;
    width: 1px;
    height: 1px;
    top: -1px;
    right: -1px;

    &:focus-visible + label {
      outline: 1px solid black;
    }

    &:checked + label {
      background-color: var(--color-40);

      #language-menu {
        display: flex;
      }
    }
  }

  #language-menu {
    display: none;
    flex-direction: column;
    background-color: var(--color-white);
    border: 1px solid var(--color-400);
    padding: 0.5rem;
    border-radius: 1.5rem;

    position: absolute;
    top: 0;
    right: 0;
    transform: translateY(44px);

    a {
      white-space: nowrap;
      padding: 1rem;
      border-radius: 1rem;

      @media (hover: hover) {
        &:hover,
        &:focus-visible {
          background-color: var(--color-40);
        }
      }
    }
  }
</style>
