---
// server route
export const prerender = false;

import { ui } from "../i18n/ui";
import {
  getLangFromUrl,
  removeTrailingSlash,
  useTranslatedPaths,
} from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const translatePaths = useTranslatedPaths(lang);

// if there's no lang parameter, detect language and redirect
if (!Astro.params.lang || !Object.keys(ui).includes(Astro.params.lang)) {
  const lang = Astro.request.headers.get("Accept-Language");
  const path = removeTrailingSlash(Astro.url.pathname);

  // if the lang is french, serve the content in french
  if (lang?.includes("fr")) {
    return Astro.redirect(translatePaths(path, "fr"));
  }

  // otherwise serve english
  return Astro.redirect(translatePaths(path, "en"));
}
---
