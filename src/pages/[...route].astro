---
// server route
export const prerender = false;

import { ui } from "@i18n/ui";
import { removeTrailingSlash, useTranslatedPaths } from "@i18n/utils";

const [_, langParam] = Astro.url.pathname.split("/");

// if there's no lang parameter, detect language and redirect
if (!langParam || !Object.keys(ui).includes(langParam)) {
  const acceptedLang = Astro.request.headers.get("Accept-Language");
  const path = removeTrailingSlash(Astro.url.pathname);

  // if the lang is french, serve the content in french
  if (acceptedLang?.includes("fr")) {
    const translatePaths = useTranslatedPaths("fr");
    return Astro.redirect(translatePaths(path));
  }

  // otherwise serve english
  const translatePaths = useTranslatedPaths("en");
  return Astro.redirect(translatePaths(path));
}

// if the page isnt found, return 404 lol
return new Response(null, {
  status: 404,
});
---
