---
// server route
export const prerender = false;

import {
  removeTrailingSlash,
  useTranslatedPaths,
  localeCodes,
  defaultLocale,
} from "@i18n";

const [_, langParam] = Astro.url.pathname.split("/");

// if there's no lang parameter, detect language and redirect
if (!langParam || !localeCodes.includes(langParam)) {
  const headerLang = Astro.request.headers.get("Accept-Language");
  const path = removeTrailingSlash(Astro.url.pathname);

  // if the lang is french, serve the content in french
  if (headerLang?.includes("fr")) {
    const translatePaths = useTranslatedPaths("fr");
    return Astro.redirect(translatePaths(path));
  }

  // otherwise serve english
  const translatePaths = useTranslatedPaths(defaultLocale);
  return Astro.redirect(translatePaths(path));
}

// if the page isnt found, return 404 lol
return new Response(null, {
  status: 404,
});
---
